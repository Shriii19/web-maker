import { useState } from 'react';
import { Button } from "/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "/components/ui/card";
import { 
  Select, 
  SelectContent, 
  SelectItem, 
  SelectTrigger, 
  SelectValue 
} from "/components/ui/select";
import { Textarea } from "/components/ui/textarea";
import { 
  Home, 
  Settings, 
  Edit, 
  Eye, 
  Plus, 
  Download, 
  Upload, 
  HelpCircle, 
  Play,
  X
} from "lucide-react";

// Define types
type Template = {
  id: string;
  name: string;
  category: string;
  description: string;
  html: string;
  css: string;
};

type DeviceView = 'desktop' | 'tablet' | 'mobile';

// Sample templates data
const sampleTemplates: Template[] = [
  {
    id: '1',
    name: 'Professional VTC Dashboard',
    category: 'Dashboard',
    description: 'Modern dashboard for VTC management',
    html: `<div class="dashboard">
  <header>
    <h1>TruckCraft Dashboard</h1>
    <nav>
      <a href="#">Home</a>
      <a href="#">Jobs</a>
      <a href="#">Fleet</a>
      <a href="#">Analytics</a>
    </nav>
  </header>
  <main>
    <section class="stats">
      <div class="stat-card">
        <h3>Active Jobs</h3>
        <p>12</p>
      </div>
      <div class="stat-card">
        <h3>Revenue</h3>
        <p>$42,500</p>
      </div>
      <div class="stat-card">
        <h3>Drivers</h3>
        <p>8</p>
      </div>
    </section>
    <section class="jobs">
      <h2>Recent Jobs</h2>
      <ul>
        <li>New York to Chicago</li>
        <li>Los Angeles to Seattle</li>
        <li>Miami to Atlanta</li>
      </ul>
    </section>
  </main>
</div>`,
    css: `.dashboard {
  font-family: Arial, sans-serif;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 20px;
  border-bottom: 1px solid #eee;
}

nav a {
  margin-left: 20px;
  text-decoration: none;
  color: #333;
}

.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 30px 0;
}

.stat-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
}

.stat-card h3 {
  margin: 0 0 10px 0;
  color: #666;
}

.stat-card p {
  font-size: 24px;
  font-weight: bold;
  margin: 0;
}

.jobs h2 {
  margin-bottom: 15px;
}

.jobs ul {
  list-style: none;
  padding: 0;
}

.jobs li {
  padding: 10px;
  border-bottom: 1px solid #eee;
}`
  },
  {
    id: '2',
    name: 'Modern Fleet Tracker',
    category: 'Tracking',
    description: 'Real-time fleet tracking interface',
    html: `<div class="fleet-tracker">
  <div class="header">
    <h1>Fleet Tracker</h1>
    <div class="controls">
      <button class="btn">Refresh</button>
      <button class="btn">Export</button>
    </div>
  </div>
  <div class="map-container">
    <div class="map-placeholder">Map Visualization</div>
  </div>
  <div class="vehicle-list">
    <h2>Active Vehicles</h2>
    <div class="vehicle">
      <span class="vehicle-id">TRK-001</span>
      <span class="status online">Online</span>
      <span class="location">New York, NY</span>
    </div>
    <div class="vehicle">
      <span class="vehicle-id">TRK-002</span>
      <span class="status offline">Offline</span>
      <span class="location">Chicago, IL</span>
    </div>
    <div class="vehicle">
      <span class="vehicle-id">TRK-003</span>
      <span class="status moving">Moving</span>
      <span class="location">Los Angeles, CA</span>
    </div>
  </div>
</div>`,
    css: `.fleet-tracker {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.controls .btn {
  background: #007bff;
  color: white;
  border: none;
  padding: 8px 16px;
  margin-left: 10px;
  border-radius: 4px;
  cursor: pointer;
}

.map-container {
  height: 400px;
  background: #e9ecef;
  border-radius: 8px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.map-placeholder {
  font-size: 24px;
  color: #6c757d;
}

.vehicle-list h2 {
  margin-bottom: 15px;
}

.vehicle {
  display: flex;
  justify-content: space-between;
  padding: 15px;
  border-bottom: 1px solid #dee2e6;
  align-items: center;
}

.vehicle-id {
  font-weight: bold;
}

.status {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
}

.online {
  background: #d4edda;
  color: #155724;
}

.offline {
  background: #f8d7da;
  color: #721c24;
}

.moving {
  background: #cce5ff;
  color: #004085;
}

.location {
  color: #6c757d;
}`
  },
  {
    id: '3',
    name: 'Driver Profile Dashboard',
    category: 'Profile',
    description: 'Driver profile and performance dashboard',
    html: `<div class="driver-dashboard">
  <div class="profile-header">
    <div class="avatar-placeholder"></div>
    <div class="driver-info">
      <h1>John Smith</h1>
      <p>Senior Driver | ID: DRV-7890</p>
      <div class="rating">
        <span>★ ★ ★ ★ ★</span>
        <span>4.9 (128 reviews)</span>
      </div>
    </div>
    <div class="actions">
      <button class="btn primary">Edit Profile</button>
      <button class="btn">Message</button>
    </div>
  </div>
  
  <div class="stats-grid">
    <div class="stat-card">
      <h3>Total Miles</h3>
      <p>124,580</p>
    </div>
    <div class="stat-card">
      <h3>Jobs Completed</h3>
      <p>842</p>
    </div>
    <div class="stat-card">
      <h3>On-Time Rate</h3>
      <p>98.7%</p>
    </div>
    <div class="stat-card">
      <h3>Earnings</h3>
      <p>$18,420</p>
    </div>
  </div>
  
  <div class="recent-activity">
    <h2>Recent Activity</h2>
    <ul>
      <li>Completed job from Miami to Atlanta (2 days ago)</li>
      <li>Started new job to Chicago (3 days ago)</li>
      <li>Vehicle maintenance completed (1 week ago)</li>
    </ul>
  </div>
</div>`,
    css: `.driver-dashboard {
  font-family: 'Roboto', sans-serif;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.profile-header {
  display: flex;
  align-items: center;
  padding-bottom: 20px;
  border-bottom: 1px solid #eee;
  margin-bottom: 30px;
}

.avatar-placeholder {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: #e9ecef;
  margin-right: 20px;
}

.driver-info h1 {
  margin: 0 0 5px 0;
}

.driver-info p {
  margin: 0 0 10px 0;
  color: #666;
}

.rating span:first-child {
  color: #ffc107;
  margin-right: 10px;
}

.actions {
  margin-left: auto;
}

.btn {
  padding: 8px 16px;
  border: 1px solid #ddd;
  background: white;
  border-radius: 4px;
  cursor: pointer;
  margin-left: 10px;
}

.btn.primary {
  background: #007bff;
  color: white;
  border-color: #007bff;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
}

.stat-card h3 {
  margin: 0 0 10px 0;
  color: #666;
  font-size: 16px;
}

.stat-card p {
  font-size: 24px;
  font-weight: bold;
  margin: 0;
}

.recent-activity h2 {
  margin-bottom: 15px;
}

.recent-activity ul {
  list-style: none;
  padding: 0;
}

.recent-activity li {
  padding: 10px;
  border-bottom: 1px solid #eee;
}`
  }
];

export default function TruckCraftStudio() {
  // State management
  const [mode, setMode] = useState<'selection' | 'editor'>('selection');
  const [templates] = useState<Template[]>(sampleTemplates);
  const [selectedTemplate, setSelectedTemplate] = useState<Template | null>(null);
  const [activeTab, setActiveTab] = useState<'settings' | 'html' | 'css' | 'components'>('settings');
  const [deviceView, setDeviceView] = useState<DeviceView>('desktop');
  const [showTutorial, setShowTutorial] = useState(false);
  const [showHowItWorks, setShowHowItWorks] = useState(false);
  const [htmlContent, setHtmlContent] = useState('');
  const [cssContent, setCssContent] = useState('');
  const [templateName, setTemplateName] = useState('');

  // Handle template selection
  const handleSelectTemplate = (template: Template) => {
    setSelectedTemplate(template);
    setHtmlContent(template.html);
    setCssContent(template.css);
    setTemplateName(template.name);
    setMode('editor');
  };

  // Handle template save
  const handleSaveTemplate = () => {
    if (selectedTemplate) {
      // In a real app, this would save to a database
      alert(`Template "${templateName}" saved successfully!`);
    }
  };

  // Handle template export
  const handleExportTemplate = () => {
    if (selectedTemplate) {
      // Create a downloadable HTML file
      const htmlContent = `
<!DOCTYPE html>
<html>
<head>
  <title>${templateName}</title>
  <style>
    ${cssContent}
  </style>
</head>
<body>
  ${htmlContent}
</body>
</html>`;
      
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${templateName.replace(/\s+/g, '-').toLowerCase()}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  };

  // Render template selection mode
  if (mode === 'selection') {
    return (
      <div className="min-h-screen bg-gray-50">
        {/* Navigation Bar */}
        <nav className="bg-white shadow-sm">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex justify-between h-16">
              <div className="flex items-center">
                <div className="flex-shrink-0 flex items-center">
                  <div className="bg-blue-600 text-white p-2 rounded-lg">
                    <Home className="h-6 w-6" />
                  </div>
                  <span className="ml-2 text-xl font-bold text-gray-900">TruckCraft Studio</span>
                </div>
              </div>
              <div className="flex items-center space-x-4">
                <Button 
                  variant="ghost" 
                  onClick={() => setShowHowItWorks(true)}
                  className="flex items-center"
                >
                  <HelpCircle className="h-4 w-4 mr-1" />
                  How It Works
                </Button>
                <Button 
                  variant="ghost" 
                  onClick={() => setShowTutorial(true)}
                  className="flex items-center"
                >
                  <Play className="h-4 w-4 mr-1" />
                  Tutorial
                </Button>
              </div>
            </div>
          </div>
        </nav>

        {/* Main Content */}
        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="text-center mb-10">
            <h1 className="text-3xl font-bold text-gray-900 mb-2">VTC Template Studio</h1>
            <p className="text-lg text-gray-600">
              Select a template to customize for your trucking community
            </p>
          </div>

          {/* Template Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {templates.map((template) => (
              <Card key={template.id} className="overflow-hidden hover:shadow-lg transition-shadow">
                <div className="bg-gray-200 h-48 flex items-center justify-center">
                  <div className="text-gray-500 text-center">
                    <div className="bg-gray-300 border-2 border-dashed rounded-xl w-16 h-16 mx-auto mb-2" />
                    <span>Template Preview</span>
                  </div>
                </div>
                <CardHeader>
                  <CardTitle className="flex justify-between items-start">
                    <span>{template.name}</span>
                    <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                      {template.category}
                    </span>
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-gray-600 text-sm mb-4">{template.description}</p>
                  <div className="flex space-x-2">
                    <Button 
                      className="flex-1"
                      onClick={() => handleSelectTemplate(template)}
                    >
                      <Edit className="h-4 w-4 mr-2" />
                      Edit
                    </Button>
                    <Button 
                      variant="outline"
                      onClick={() => {
                        setSelectedTemplate(template);
                        setMode('editor');
                      }}
                    >
                      <Eye className="h-4 w-4 mr-2" />
                      Preview
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </main>

        {/* Tutorial Modal */}
        {showTutorial && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <Card className="w-full max-w-2xl">
              <CardHeader className="flex flex-row justify-between items-center">
                <CardTitle>Tutorial</CardTitle>
                <Button variant="ghost" onClick={() => setShowTutorial(false)}>
                  <X className="h-4 w-4" />
                </Button>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h3 className="font-bold text-blue-800">Step 1: Select a Template</h3>
                    <p>Browse through our collection of professional VTC templates and select one that fits your needs.</p>
                  </div>
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h3 className="font-bold text-blue-800">Step 2: Customize</h3>
                    <p>Use our editor to modify colors, content, and layout to match your brand.</p>
                  </div>
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h3 className="font-bold text-blue-800">Step 3: Export</h3>
                    <p>Download your customized template as HTML/CSS files for immediate use.</p>
                  </div>
                  <Button className="w-full" onClick={() => setShowTutorial(false)}>
                    Got It!
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>
        )}

        {/* How It Works Modal */}
        {showHowItWorks && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <Card className="w-full max-w-2xl">
              <CardHeader className="flex flex-row justify-between items-center">
                <CardTitle>How It Works</CardTitle>
                <Button variant="ghost" onClick={() => setShowHowItWorks(false)}>
                  <X className="h-4 w-4" />
                </Button>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <p>TruckCraft Studio helps VTC communities create professional websites without coding knowledge.</p>
                  <div className="flex items-start space-x-3">
                    <div className="bg-blue-100 text-blue-800 rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">1</div>
                    <div>
                      <h3 className="font-bold">Choose a Template</h3>
                      <p>Select from our professionally designed templates tailored for trucking communities.</p>
                    </div>
                  </div>
                  <div className="flex items-start space-x-3">
                    <div className="bg-blue-100 text-blue-800 rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">2</div>
                    <div>
                      <h3 className="font-bold">Customize</h3>
                      <p>Modify colors, content, and layout using our intuitive editor.</p>
                    </div>
                  </div>
                  <div className="flex items-start space-x-3">
                    <div className="bg-blue-100 text-blue-800 rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">3</div>
                    <div>
                      <h3 className="font-bold">Export & Use</h3>
                      <p>Download your customized template and implement it on your website.</p>
                    </div>
                  </div>
                  <Button className="w-full" onClick={() => setShowHowItWorks(false)}>
                    Close
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>
        )}
      </div>
    );
  }

  // Render editor mode
  return (
    <div className="min-h-screen bg-gray-50 flex flex-col">
      {/* Editor Navigation */}
      <nav className="bg-white shadow-sm">
        <div className="px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between h-16">
            <div className="flex items-center">
              <Button 
                variant="ghost" 
                onClick={() => setMode('selection')}
                className="flex items-center"
              >
                <Home className="h-4 w-4 mr-2" />
                Templates
              </Button>
              <div className="ml-4 text-lg font-medium text-gray-900">
                {templateName}
              </div>
            </div>
            <div className="flex items-center space-x-2">
              <Button variant="outline" onClick={handleSaveTemplate}>
                <Upload className="h-4 w-4 mr-2" />
                Save
              </Button>
              <Button onClick={handleExportTemplate}>
                <Download className="h-4 w-4 mr-2" />
                Export
              </Button>
            </div>
          </div>
        </div>
      </nav>

      {/* Editor Tabs */}
      <div className="border-b bg-white">
        <div className="px-4 sm:px-6 lg:px-8">
          <div className="flex space-x-8">
            <button
              className={`py-4 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'settings'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              }`}
              onClick={() => setActiveTab('settings')}
            >
              <Settings className="h-4 w-4 inline mr-2" />
              Settings
            </button>
            <button
              className={`py-4 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'html'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              }`}
              onClick={() => setActiveTab('html')}
            >
              HTML
            </button>
            <button
              className={`py-4 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'css'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              }`}
              onClick={() => setActiveTab('css')}
            >
              CSS
            </button>
            <button
              className={`py-4 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'components'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              }`}
              onClick={() => setActiveTab('components')}
            >
              <Plus className="h-4 w-4 inline mr-2" />
              Components
            </button>
          </div>
        </div>
      </div>

      {/* Main Editor Content */}
      <div className="flex flex-1 overflow-hidden">
        {/* Editor Panel */}
        <div className="w-1/2 border-r bg-white overflow-auto">
          {activeTab === 'settings' && (
            <div className="p-6">
              <h2 className="text-xl font-bold mb-4">Template Settings</h2>
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Template Name
                  </label>
                  <input
                    type="text"
                    value={templateName}
                    onChange={(e) => setTemplateName(e.target.value)}
                    className="w-full p-2 border rounded-md"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Primary Color
                  </label>
                  <div className="flex space-x-2">
                    {['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b'].map((color) => (
                      <div
                        key={color}
                        className="w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow"
                        style={{ backgroundColor: color }}
                        onClick={() => {
                          // In a real app, this would update the CSS
                        }}
                      />
                    ))}
                  </div>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Preview Device
                  </label>
                  <Select value={deviceView} onValueChange={(value: DeviceView) => setDeviceView(value)}>
                    <SelectTrigger className="w-[180px]">
                      <SelectValue placeholder="Select device" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="desktop">Desktop</SelectItem>
                      <SelectItem value="tablet">Tablet</SelectItem>
                      <SelectItem value="mobile">Mobile</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>
            </div>
          )}

          {activeTab === 'html' && (
            <div className="p-4 h-full">
              <h2 className="text-xl font-bold mb-4">HTML Editor</h2>
              <Textarea
                value={htmlContent}
                onChange={(e) => setHtmlContent(e.target.value)}
                className="font-mono text-sm h-[calc(100vh-200px)]"
              />
            </div>
          )}

          {activeTab === 'css' && (
            <div className="p-4 h-full">
              <h2 className="text-xl font-bold mb-4">CSS Editor</h2>
              <Textarea
                value={cssContent}
                onChange={(e) => setCssContent(e.target.value)}
                className="font-mono text-sm h-[calc(100vh-200px)]"
              />
            </div>
          )}

          {activeTab === 'components' && (
            <div className="p-6">
              <h2 className="text-xl font-bold mb-4">Add Components</h2>
              <div className="grid grid-cols-2 gap-4">
                {['Header', 'Footer', 'Stats Card', 'Job List', 'Map', 'Driver Profile'].map((component) => (
                  <Card key={component} className="cursor-pointer hover:shadow-md">
                    <CardContent className="p-4 text-center">
                      <div className="bg-gray-200 border-2 border-dashed rounded-xl w-16 h-16 mx-auto mb-2" />
                      <span className="text-sm">{component}</span>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </div>
          )}
        </div>

        {/* Preview Panel */}
        <div className="w-1/2 bg-gray-100 overflow-auto p-6">
          <div className="mb-4 flex justify-between items-center">
            <h2 className="text-xl font-bold">Preview</h2>
            <div className="flex space-x-2">
              <Button 
                variant={deviceView === 'desktop' ? 'default' : 'outline'} 
                size="sm"
                onClick={() => setDeviceView('desktop')}
              >
                Desktop
              </Button>
              <Button 
                variant={deviceView === 'tablet' ? 'default' : 'outline'} 
                size="sm"
                onClick={() => setDeviceView('tablet')}
              >
                Tablet
              </Button>
              <Button 
                variant={deviceView === 'mobile' ? 'default' : 'outline'} 
                size="sm"
                onClick={() => setDeviceView('mobile')}
              >
                Mobile
              </Button>
            </div>
          </div>
          
          <div className={`bg-white rounded-lg shadow-lg mx-auto ${
            deviceView === 'desktop' ? 'w-full' : 
            deviceView === 'tablet' ? 'w-[768px]' : 'w-[375px]'
          } min-h-[600px] p-4`}>
            <style>{cssContent}</style>
            <div dangerouslySetInnerHTML={{ __html: htmlContent }} />
          </div>
        </div>
      </div>
    </div>
  );
}